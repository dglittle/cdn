
<script src="https://dglittle.github.io/cdn/random001.js"></script>
<script src="https://dglittle.github.io/cdn/utils004.js"></script>
<script src="https://invisible-college.github.io/universal-sync/diffsync.js"></script>
<body></body>
<script>

var d = document.createElement('div')
d.textContent = 'hi!'
document.body.append(d)

var c = document.createElement('canvas')
c.width = 500
c.height = 500
document.body.append(c)
var g = c.getContext('2d')

g.beginPath()
g.moveTo(100, 0)
g.lineTo(0, 100)
g.strokeStyle = 'red'
g.stroke()


sync9_trav_space_dag(get_test_S(), () => true, (node, offset, has_nexts, prev, vid) => {
    g.fillText('H', 100, 100)
})


function sync9_trav_space_dag(S, f, cb, view_deleted, tail_cb) {
    var exit_early = {}
    var offset = 0
    function helper(node, prev, vid) {
        var has_nexts = node.nexts.find(next => f(next.vid))
        if (view_deleted ||
            !Object.keys(node.deleted_by).some(vid => f(vid))) {
            if (cb(node, offset, has_nexts, prev, vid) == false)
                throw exit_early
            offset += node.elems.length
        }
        for (var next of node.nexts)
            if (f(next.vid)) helper(next, null, next.vid)
        if (node.next) helper(node.next, node, vid)
        else if (tail_cb) tail_cb(node)
    }
    try {
        helper(S, null, S.vid)
    } catch (e) {
        if (e != exit_early) throw e
    }
}

function get_test_S() {
    return {"t":"str","S":{"vid":0,"elems":"","deleted_by":{},"nexts":[{"vid":1,"elems":"","deleted_by":{},"end_cap":false,"nexts":[{"vid":3,"elems":"","deleted_by":{},"end_cap":false,"nexts":[{"vid":8,"elems":"FFFF","deleted_by":{},"nexts":[],"next":null}],"next":{"vid":null,"elems":"aaa","deleted_by":{},"end_cap":false,"nexts":[{"vid":4,"elems":"bbb","deleted_by":{},"nexts":[],"next":null}],"next":{"vid":null,"elems":"a","deleted_by":{},"nexts":[],"next":null}}}],"next":{"vid":null,"elems":"","deleted_by":{},"end_cap":true,"nexts":[{"vid":7,"elems":"EE","deleted_by":{},"nexts":[],"next":null}],"next":{"vid":null,"elems":"AAA","deleted_by":{"7":true},"end_cap":false,"nexts":[{"vid":2,"elems":"","deleted_by":{"7":true},"end_cap":false,"nexts":[{"vid":5,"elems":"CCCC","deleted_by":{"7":true},"nexts":[],"next":null,"real_next":{"vid":null,"elems":"D","deleted_by":{},"nexts":[],"next":null}}],"next":{"vid":null,"elems":"","deleted_by":{"7":true},"end_cap":true,"nexts":[{"vid":6,"elems":"D","deleted_by":{"7":true},"nexts":[],"next":{"vid":null,"elems":"D","deleted_by":{},"nexts":[],"next":null}}],"next":{"vid":null,"elems":"B","deleted_by":{"6":true},"nexts":[],"next":null,"gash":true}}}],"next":{"vid":null,"elems":"A","deleted_by":{"6":true},"nexts":[],"next":null},"gash":true}}}],"next":null}}
}



</script>
